<!DOCTYPE html>
<html>
	<head>
	    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
		<script type="text/javascript">
	
		$(document).ready(function(e) {
					var number_tmp = window.location.search.split("?")[1].split('&')[0].split("=")[1];
					console.log(number_tmp);
					$.get("https://script.google.com/macros/s/AKfycby8FMMIJQkm0lAqUzyP_epJiw1dP3JMZ8VdiTGHckpfEVpecs-N/exec",
				
							{
									number:number_tmp,
									"command":"read",	
									tab:"blog"
							},
						function (data) {
							console.log("the result is :"+data);
							$('#text-input').val(data);
							$('#text-input')[0].editor.update()
						});
			
		});


        
    </script>
		<script src="markdown.js"></script>
	<script src = "html_preprocessing.js"></script>

<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <script type="text/javascript">
        function SendScore(){
            $.get("https://script.google.com/macros/s/AKfycbwBJv96vJClyQMJbktpy8ZuMuPateF-OWrOmuY7GkS33AFxUFVT/exec", {
                        "title": document.getElementById("titleInput").value,
                        "content": document.getElementById("text-input").value,
						"is_public":$("#is_publicInput").prop("checked")
                    },
                    function (data) {
						$('#feedback').html(data)
                    //    document.write("--------------------------");
                    //   document.write("Result = "+data);
                    //   document.write("--------------------------");
                    });
        }
    </script>
	</head>
  <body>    
<div class="container">
<div class="row">
	<div class="col-lg-12 bg-warning">
		<ul>
			<li><a href="../ui_cmd.html">Home</a></li>
			<li><a href="../blog/" target="_blank">Blog</a></li>
			<li><a href="../gallery/" target="_blank">Gallery</a></li>
			<li><a href="https://svg-edit.github.io/svgedit/releases/svg-edit-2.8.1/svg-editor.html" target="_blank">SVG Editor</a></li>
		</ul>
	</div>
	<div class="col-lg-12 bg-info">
		<div id="div_photo_list"></div>
	</div>
	<div class="col-lg-12" id="preview_link" style="overflow:auto"></div>
	<div class="col-lg-12" id="title">[Filename]</div>
	<div class="col-lg-12">
    		title: <input type="text" id="titleInput"><br><br>
	</div>
	<div class="col-lg-6" id="title">
	    <textarea class="AutoHeight" id="text-input" oninput=this.editor.update()
               style="width:100%" rows="30">Type **Markdown** here.test
	  </textarea>
	</div>
    	<div class="col-lg-6" id="preview"> </div>
	<div class="col-lg-12">
    		<input type="button" value="send" onclick="SendScore()">
		<p>cmd</p>
		<div id='path'>~/$</div>	
		
    		<textarea id="text" rows="1" style="width:100%"></textarea>
	</div>
	<div class="col-lg-12 bg-info">
		<p>client response:</p>
		<div id='client_response'></div>	
		    <p>server response:</p>
	    <div id="div_response"></div>
</div>

	</div>	
</div>




    <script>
      var filename;
      //var socket = io.connect();
      var current_dir = '';

      $(document).ready(function(){
	$('#text').focus(function(){
		$('#text').val("");
	});
	$('#text').val("input your command here\n");
/*
	socket.emit('markdown',{
		'type':'cmd',
		'command':'ls_photo',
		'path':current_dir
	});
*/
        $('#text').keypress(function(e){
          //socket.emit('client_data', {
          //  'letter': String.fromCharCode(e.charCode)
          //}i);

	  if(e.charCode==13){ //enter(i.e. return)
		num_input_element = $('#text').val().split('\n').length;
//		console.log($('#text-input').val());
		var cmd;
		if(num_input_element==1){
			cmd = $('#text').val();
		}else{
			cmd = $('#text').val().split('\n')[1];
			
		}
		switch(cmd.split(' ')[0]){
			case('save'):{
				console.log('save');
//				console.log($('#text-input').html());
				if(filename){			
					console.log(parse_result.tag_content_array);
					//console.log($('#preview').html());
					socket.emit('markdown',{
						'type':'cmd',
						'command':'save',
						'markdown_content':$('#text-input').val(),
						'html_content':$('#preview').html(),
						'path':current_dir,
						'filename':filename,
						'publish':parse_result.publish,
						'tag':parse_result.tag_content_array
					});
					//console.log('markdown content:'+$('#text-input').val());
					console.log('file saved');
					$('#client_response').html('file saved');
				}else{
					console.log('please select a file to edit');
					$('#client_response').html('please select a file to edit');
					break;
				}
				break;
			}
			case('ls'):{
//				console.log('ls');
				console.log('ls:'+current_dir);
				socket.emit('markdown',{
					'type':'cmd',
					'command':'ls',
					'path':current_dir
				});
				break;
			}
			case('ls_photo'):{
//				console.log('ls');
				console.log('ls:'+current_dir);
				socket.emit('markdown',{
					'type':'cmd',
					'command':'ls_photo',
					'path':current_dir
				});
				break;
			}
			case('edit'):{
				if(cmd.split(' ')[1]){
					argv = cmd.split(' ')[1];
					filename = argv;
					socket.emit(
						'markdown',
						{
							'type':'cmd',
							'command':'edit',
							'filename':filename
						}
					);
					$('#title').html(current_dir+filename+'.markdown');
				}else{

					$('#client_response').html('please enter the filename as argument[1]');
				}
				break;
			}
			case('mkdir'):{
				if(cmd.split(' ')[1]){
					argv = cmd.split(' ')[1];
					socket.emit('markdown',{
						'type':'cmd',
						'command':'mkdir',
						'path':argv
					});
					
				}else{
					$('#client_response').html('please enter the directory name as argument[1]');

				}
				break;

			}
			case('cd'):{
				console.log('cmd:'+cmd);
				if(cmd.split(' ')[1]){
					argv = cmd.split(' ')[1];
					socket.emit('markdown',{
						'type':'cmd',
						'command':'cd',
						'path':argv
					});
					$('#form_dir_name').val(argv);
				}else{

					$('#client_response').html('please enter the filepath as argument[1]');
				}
				/*
				if(cmd.split(' ')[1]){
					argv = cmd.split(' ')[1];
					if(argv=='..'){
						var new_path='';
						var path_tmp = current_dir.split('/');
						switch(path_tmp.length){
							case 2: console.log('you are alrealy in root');
								break;
							case 3: path_tmp.splice(1,1);break;
							case 4: path_tmp.splice(2,1);break;
						}
						for(var i=0;i<path_tmp.length;i++){
							new_path+=path_tmp[i];
							if(path_tmp[i]=='')break;
							new_path+='/';
						}
						console.log('2:'+new_path);
						current_dir = new_path;
					}else{
						current_dir += argv+'/';
					}
					$('#title').html('/'+current_dir+filename+'.markdown');
					
				}else{
					$('#client_response').html('please enter the filepath as argument[1]');
					
				}
				*/
				break;
			}
			
			case('rm'):{
				if(cmd.split(' ')[1]){
					argv = cmd.split(' ')[1];
					filename = argv;
					socket.emit('markdown',{
						'type':'cmd',
						'command':'rm',
						'filename':argv
					});
				}else{
					$('#client_response').html('please enter the filename as argument[1]');

				}
				break;
			}
			case('new'):{
				if(cmd.split(' ')[1]){					
					argv = cmd.split(' ')[1];
					filename = argv;
					$('#title').html(current_dir+filename+'.markdown');
					
				}else{
					console.log('please enter the filename as argument[1]');
					$('#client_response').html('please enter the filename as argument[1]');
				}
				break;

//				console.log('argv:'+argv);
			}
			case('clear'):{
				filename='';
				$('#title').html('[filename]');
				break;
			}
			/*
			case('pwd'):{
				
				socket.emit('markdown',{
					'type':'cmd',
					'command':'pwd'
				});
				
				break;
			}
			*/
			default:{
				$('#client_response').html('command not support.');
			}
		}

		$('#text').val('');
	   }
        });
      });
    </script>
    
    <script src="showdown.min.js"></script>
    <script>
	var converter = new showdown.Converter();
	converter.setOption('tables',true);
	converter.setOption('tasklists',true);
      function Editor(input, preview) {
        this.update = function () {
		preview.innerHTML = "";
		content = input.value;
		//console.log(content);	
		[preprocessed_content, parse_result, StringSet] = html_preprocessing(content);	
		for(var i=0;i<StringSet.length;i++){
			switch(StringSet[i].property){
				case "markdown_input":{
					//console.log("markdown_input");
//					console.log(StringSet[i].data);
					var html_results = markdown.toHTML(StringSet[i].data);
					preview.innerHTML += html_results;
					break;
				}
				case "system_cmd":{
					//console.log("system_cmd");	
					break;
				}
				case "html":{
					//console.log("html");
//					console.log(StringSet[i].data);
					preview.innerHTML += StringSet[i].data;
					
					break;
				}
				case "u2b":{
					preview.innerHTML += StringSet[i].data;
					break;
				}
			}
		}
		  var final_html = html_results;
		  var preview_height = $('#preview').height();
		  if(preview_height < 100) preview_height = 100;
		
		  $('.AutoHeight').height(preview_height);
        };
        input.editor = this;
//	$("#text-input").height($("#preview").height());
//	input.height(preview.height());
        this.update();
      }
      var $$ = function (id) { return document.getElementById(id); };
      new Editor($$("text-input"), $$("preview"));
    </script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
  </body>
</html>
